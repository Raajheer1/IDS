<!--
   ZDV IDS - Information Display System
   Copyright (C) 2021  Raaj T. Patel <raaj.patel229@gmail.com>

   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU Affero General Public License as published
   by the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.
   
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU Affero General Public License for more details.

   You should have received a copy of the GNU Affero General Public License
   along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Denver IDS</title>
  <link rel="stylesheet" href="https://bootswatch.com/4/darkly/bootstrap.min.css">
  <link rel="stylesheet" href="./customstyle.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
</head>

<body style="background: url('img/Background.jpg') no-repeat center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav" style="margin-top: 15px;">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger"><img src="img/logo.png" style="max-height: 115px;"></a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span
          class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto my-2 my-lg-0">
          <!-- <li style="font-size: 25px;padding-right: 15px;" class="nav-item"><a class="nav-link js-scroll-trigger" href="#" style="color: black;"><span style='color: #F97E41;text-decoration:line-through'><span style='color:black'>PREDUTY</span></span></a></li> -->
          <li style="font-size: 25px;padding-right: 15px;" class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html" style="color: black;">IDS4</a></li>
          <!-- <li style="font-size: 25px;padding-right: 15px;" class="nav-item"><a class="nav-link js-scroll-trigger" href="#" style="color: black;"><span style='color: #F97E41;text-decoration:line-through'><span style='color:black'>ER-IDS</span></span></a></li> -->
          <li style="font-size: 25px;padding-right: 15px;" class="nav-item"><a class="nav-link js-scroll-trigger" style="color: black;" data-toggle="modal" data-target="#usermodal" href=""><span style='color: #F97E41;text-decoration:underline'><span style='color:black'><span id="name"></span> <span id="rating"></span></span></span></a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Body -->
  <div class="container" style="padding-top: calc(100vh / 3.75);">
    <div class="row" style="justify-content: center;">
      <h1 style="font-size: 75px; text-align: center;">Denver Information <br>Display System</h1>
    </div>
    <div class="row" style="justify-content: center;">
      <div class="output" id="output">
        <h1 style="font-weight: 100;"><span id="cursor"></span></h1>
      </div>
    </div>
  </div>

  <!-- UserInfo Modal -->
  <div class="modal pt-5" id="usermodal" role="dialog" aria-labelledby="usermodallabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal">
        <div class="modal-content text-white">
          <div class="modal-header">
            <h5 class="modal-title" id="usermodallabel">Profile</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span class="TextOr" aria-hidden="true">Ã—</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group row">
              <div class="col-12 d-flex flex-column justify-content-center align-items-center">
                <h3><span id="namemodal"></span> (<span id="oimodal"></span>)</h3>
              </div>
            </div>

            <!-- Controller Info -->
            <div class="row">
              <div class="col-6 d-flex flex-column justify-content-center align-items-center">
                <h4 class="TextOr"><span id="CID"></span></h4>
                <span>CID</span>
              </div>
              <div class="col-6 d-flex flex-column justify-content-center align-items-center">
                <h4 class="TextOr"><span id="Rating"></span></h4>
                <span>Rating</span>
              </div>
            </div>

            <!-- Controller Stats -->
            <hr style="height: 2px; color: #f97e41; background-color: #f97e41;">
            <div class="row">
              <div class="col-6 d-flex flex-column justify-content-center align-items-center">
                <h4 class="TextOr"><span id="HoursYR"></span></h4>
                <span>Hours (Year)</span>
              </div>
              <div class="col-6 d-flex flex-column justify-content-center align-items-center">
                <h4 class="TextOr"><span id="HoursMO"></span></h4>
                <span>Hours (Month)</span>
              </div>
            </div>

            <!-- FOOTER NOTES -->
            <hr style="height: 2px; color: back; background-color: #f97e41;">
          
          </div>
        </div>
    </div>
  </div>

  <div class="container" id="TrainingSession" style="height: 20%; display: flex; align-items: center; justify-content: center;">
  </div>
  <div class="container" id="Documents" style="height: 10%; display: flex; align-items: center; justify-content: center;">
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script>window.jQuery = window.$ = module.exports</script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  <script>
    const customTitlebar = require('custom-electron-titlebar');
    const remote = require('electron').remote;
    const Menu = remote.Menu;
    const MenuItem = remote.MenuItem;
    var menu = new Menu();
    menu.append(new MenuItem({
        label: 'ZDV',
        submenu: [
            {
                label: 'Website',
                click: () => require('electron').shell.openExternal("https://denartcc.org/")
            },
            {
                type: 'separator'
            }
        ]
    }));
    let IDSTitleBar = new customTitlebar.Titlebar({
      backgroundColor: customTitlebar.Color.fromHex("#1F1F1F"),
      shadow: true,
      icon: "./img/icon.png"
    });
    IDSTitleBar.updateMenu(menu);
    IDSTitleBar.updateTitle('ZDVARTCC');
  </script>
  <script>
    const { ipcRenderer } = require('electron');
    var UserData = ipcRenderer.sendSync('synchronous-message', '');
    document.getElementById("name").innerHTML = UserData[3] + " -";
    document.getElementById("rating").innerHTML = UserData[4];
    sessions = UserData[11]
    sessions.forEach(element => {
      document.getElementById("TrainingSession").innerHTML += `
      <div class="alert alert-dismissible alert-warning">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <h4 class="alert-heading">Training Sessions</h4>
        <p class="mb-0">You have an upcoming Training Session with `+element['mentor']['first_name']+ ` ` +  element['mentor']['last_name'] + `. 
          Your time slot is ` +element['slot']+`.</p>
      </div><br>
      `
    });
    sessions = UserData[12]
    if(sessions != []){
      stringstuff = `
        <div class="alert alert-dismissible alert-danger">
          <button type="button" class="close" data-dismiss="alert">&times;</button>
          <h4 class="alert-heading">Document Updates</h4>
          <p class="mb-0">Read/Download the following documents prior to your next controlling session: <br>` 
      sessions.forEach(element => {
        stringstuff += element[0] + "<br> "
      });
      stringstuff += `</p></div><br>`
      if(sessions.length != 0){
        document.getElementById("Documents").innerHTML = stringstuff
      }
    }
    
    //userModal
    document.getElementById("namemodal").innerHTML = UserData[1] + " " + UserData[2];
    document.getElementById("oimodal").innerHTML = UserData[3];
    document.getElementById("CID").innerHTML = UserData[0];
    document.getElementById("Rating").innerHTML = UserData[4];
  </script>
  <script>
    var i = 0,
      a = 0,
      isBackspacing = false,
      isParagraph = false;

    // Typerwrite text content. Use a pipe to indicate the start of the second line "|".  
    var textArray = [
      "Welcome " + UserData[1] + " " + UserData[2] + "! | Testing 123" + UserData[3] + " " + UserData[4] + " " + UserData[5]];

    // Speed (in milliseconds) of typing.
    var speedForward = 100, //Typing Speed
      speedWait = 10000000, // Wait between typing and backspacing
      speedBetweenLines = 10, //Wait between first and second lines
      speedBackspace = 25; //Backspace Speed

    //Run the loop
    typeWriter("output", textArray);

    function typeWriter(id, ar) {
      var element = $("#" + id),
        aString = ar[a],
        eHeader = element.children("h1"), //Header element
        eParagraph = element.children("p"); //Subheader element

      // Determine if animation should be typing or backspacing
      if (!isBackspacing) {

        // If full string hasn't yet been typed out, continue typing
        if (i < aString.length) {

          // If character about to be typed is a pipe, switch to second line and continue.
          if (aString.charAt(i) == "|") {
            isParagraph = true;
            eHeader.removeClass("cursor");
            eParagraph.addClass("cursor");
            i++;
            setTimeout(function () { typeWriter(id, ar); }, speedBetweenLines);

            // If character isn't a pipe, continue typing.
          } else {
            // Type header or subheader depending on whether pipe has been detected
            if (!isParagraph) {
              eHeader.text(eHeader.text() + aString.charAt(i));
            } else {
              eParagraph.text(eParagraph.text() + aString.charAt(i));
            }
            i++;
            setTimeout(function () { typeWriter(id, ar); }, speedForward);
          }

          // If full string has been typed, switch to backspace mode.
        } else if (i == aString.length) {

          isBackspacing = true;
          setTimeout(function () { typeWriter(id, ar); }, speedWait);

        }

        // If backspacing is enabled
      } else {

        // If either the header or the paragraph still has text, continue backspacing
        if (eHeader.text().length > 0 || eParagraph.text().length > 0) {

          // If paragraph still has text, continue erasing, otherwise switch to the header.
          if (eParagraph.text().length > 0) {
            eParagraph.text(eParagraph.text().substring(0, eParagraph.text().length - 1));
          } else if (eHeader.text().length > 0) {
            eParagraph.removeClass("cursor");
            eHeader.addClass("cursor");
            eHeader.text(eHeader.text().substring(0, eHeader.text().length - 1));
          }
          setTimeout(function () { typeWriter(id, ar); }, speedBackspace);

          // If neither head or paragraph still has text, switch to next quote in array and start typing.
        } else {

          isBackspacing = false;
          i = 0;
          isParagraph = false;
          a = (a + 1) % ar.length; //Moves to next position in array, always looping back to 0
          setTimeout(function () { typeWriter(id, ar); }, 50);

        }
      }
    }
  </script>
</body>
<script>
  require('./renderer.js')
</script>

</html>